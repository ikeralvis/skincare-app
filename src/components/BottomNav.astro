---
// src/components/BottomNav.astro
// Navegación inferior estilo móvil (Duolingo, Instagram, TikTok)
---

<nav id="bottom-nav" class="bottom-nav" style="display: none;">
  <button class="nav-item active" data-view="guide">
    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
      <polyline points="9 22 9 12 15 12 15 22"></polyline>
    </svg>
    <span class="nav-label">Inicio</span>
  </button>

  <button class="nav-item" data-view="calendar">
    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
      <line x1="16" y1="2" x2="16" y2="6"></line>
      <line x1="8" y1="2" x2="8" y2="6"></line>
      <line x1="3" y1="10" x2="21" y2="10"></line>
    </svg>
    <span class="nav-label">Calendario</span>
  </button>

  <!-- Botón central destacado de Chat IA -->
  <button class="nav-item nav-item-chat" data-view="chat">
    <div class="chat-button-special">
      <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        <circle cx="12" cy="11" r="1" fill="currentColor"/>
        <circle cx="8" cy="11" r="1" fill="currentColor"/>
        <circle cx="16" cy="11" r="1" fill="currentColor"/>
      </svg>
    </div>
    <span class="nav-label">Chat IA</span>
  </button>

  <button class="nav-item" data-view="progress">
    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
    </svg>
    <span class="nav-label">Progreso</span>
  </button>

  <button class="nav-item" data-view="routines">
    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
    </svg>
    <span class="nav-label">Rutina</span>
  </button>
</nav>

<style>
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-top: 2px solid rgba(0, 255, 255, 0.3);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 0.5rem 0;
    z-index: 1000;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
    /* Safe area para iOS con notch */
    padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .bottom-nav.visible {
    opacity: 1;
  }

  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.2rem;
    padding: 0.4rem 0.5rem;
    text-decoration: none;
    color: rgba(255, 255, 255, 0.6);
    transition: all 0.3s ease;
    cursor: pointer;
    flex: 1;
    min-width: 0;
    max-width: 90px;
    background: none;
    border: none;
    font-family: inherit;
  }

  .nav-item:hover,
  .nav-item.active {
    color: #00ffff;
  }

  .nav-icon {
    width: 24px;
    height: 24px;
    stroke-width: 2;
    transition: all 0.3s ease;
  }

  .nav-item:hover .nav-icon,
  .nav-item.active .nav-icon {
    stroke: #00ffff;
    filter: drop-shadow(0 0 8px rgba(0, 255, 255, 0.6));
    transform: scale(1.1);
  }

  .nav-label {
    font-size: 0.65rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* Botón especial de Chat IA */
  .nav-item-chat {
    position: relative;
  }

  .chat-button-special {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 20px rgba(255, 107, 107, 0.5);
    transition: all 0.3s ease;
    margin-bottom: 0.2rem;
    border: 2px solid rgba(0, 0, 0, 0.3);
    animation: pulse-glow-bottom 2s ease-in-out infinite;
  }

  .chat-button-special .nav-icon {
    width: 28px;
    height: 28px;
    stroke: white;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
  }

  .nav-item-chat:hover .chat-button-special,
  .nav-item-chat.active .chat-button-special {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(255, 107, 107, 0.7);
  }

  @keyframes pulse-glow-bottom {
    0%, 100% {
      box-shadow: 0 4px 20px rgba(255, 107, 107, 0.5);
    }
    50% {
      box-shadow: 0 6px 30px rgba(255, 107, 107, 0.8);
    }
  }

  /* Animación al pulsar */
  .nav-item:active {
    transform: scale(0.95);
  }

  /* Espaciado para el contenido (evitar que el navbar tape contenido) */
  :global(body) {
    padding-bottom: calc(70px + env(safe-area-inset-bottom));
  }

  /* Responsive para tablets/desktop */
  @media (min-width: 768px) {
    .bottom-nav {
      display: none; /* Ocultar en desktop, o puedes mantenerlo */
    }
    :global(body) {
      padding-bottom: 0;
    }
  }

  /* Ajustes para pantallas muy pequeñas */
  @media (max-width: 360px) {
    .nav-item {
      padding: 0.4rem 0.3rem;
      min-width: 0;
      flex: 1;
    }
    .nav-icon {
      width: 20px;
      height: 20px;
    }
    .nav-label {
      font-size: 0.6rem;
    }
    .chat-button-special {
      width: 48px;
      height: 48px;
    }
    .chat-button-special .nav-icon {
      width: 24px;
      height: 24px;
    }
  }
  
  /* Ajustes adicionales para pantallas extra pequeñas */
  @media (max-width: 320px) {
    .nav-item {
      padding: 0.3rem 0.2rem;
      gap: 0.15rem;
    }
    .nav-icon {
      width: 18px;
      height: 18px;
    }
    .nav-label {
      font-size: 0.55rem;
    }
    .chat-button-special {
      width: 44px;
      height: 44px;
    }
  }
</style>

<script>
  // Cambiar entre vistas sin recargar la página
  document.addEventListener('DOMContentLoaded', () => {
    const navItems = document.querySelectorAll('.nav-item');
    
    navItems.forEach(item => {
      item.addEventListener('click', function(this: HTMLElement, e: Event) {
        e.preventDefault();
        
        const viewName = this.getAttribute('data-view');
        
        // Si tiene vista, activarla
        if (viewName) {
          // Remover active de todos
          navItems.forEach(nav => nav.classList.remove('active'));
          this.classList.add('active');
          
          // Disparar evento para cambiar vista
          window.dispatchEvent(new CustomEvent('change-view', { detail: viewName }));
        }
        
        // Efecto ripple
        const ripple = document.createElement('span');
        ripple.style.cssText = `
          position: absolute;
          border-radius: 50%;
          background: rgba(0, 255, 255, 0.3);
          width: 50px;
          height: 50px;
          pointer-events: none;
          animation: ripple-effect 0.6s ease-out;
        `;
        this.style.position = 'relative';
        this.style.overflow = 'hidden';
        this.appendChild(ripple);
        
        setTimeout(() => ripple.remove(), 600);
      });
    });
  });

  // Añadir keyframes para el ripple
  const style = document.createElement('style');
  style.textContent = `
    @keyframes ripple-effect {
      from {
        transform: scale(0);
        opacity: 1;
      }
      to {
        transform: scale(2);
        opacity: 0;
      }
    }
  `;
  document.head.appendChild(style);
</script>
